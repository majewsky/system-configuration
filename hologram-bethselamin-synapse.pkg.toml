[package]
name        = "hologram-bethselamin-synapse"
version     = "1.2.0"
description = "hologram: Matrix Synapse server on Bethselamin"
requires    = []

[[action]]
on     = "cleanup"
script = '''
  rm -f /etc/synapse/dhparam.pem
'''

[[directory]]
path  = "/data/synapse"
mode  = "0770"
owner = "synapse"
group = "synapse"

[[file]]
path    = "/etc/nginx/sites-enabled/synapse.conf"
content = '''
    server {
        server_name bethselamin.de;
        include     /etc/nginx/server-baseline-https.inc;

        ssl_certificate     /etc/letsencrypt/live/bethselamin.de/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/bethselamin.de/privkey.pem;
        ssl_trusted_certificate /etc/letsencrypt/live/bethselamin.de/chain.pem;

        location /.well-known/matrix/server {
            add_header Content-Type application/json;
            return 200 '{"m.server":"bet.of.xyrillian.de:443"}';
        }
        location /.well-known/matrix/client {
            add_header Content-Type application/json;
            add_header Access-Control-Allow-Origin *;
            return 200 '{"m.homeserver":{"base_url":"https://bet.of.xyrillian.de"},"m.identity_server":{"base_url":"https://vector.im"}}';
        }
    }
'''
